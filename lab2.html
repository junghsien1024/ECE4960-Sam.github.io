<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Fast Robots: ECE 4960 Lab 2</title>
    <!--

    Template 2103 Central

	http://www.tooplate.com/view/2103-central

    -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">
    <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.5.0/css/font-awesome.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="slick/slick-theme.css" />
    <link rel="stylesheet" href="css/tooplate-style.css">
    <!-- tooplate style -->

    <script>
        var renderPage = true;

        if (navigator.userAgent.indexOf('MSIE') !== -1
            || navigator.appVersion.indexOf('Trident/') > 0) {
            /* Microsoft Internet Explorer detected in. */
            alert("Please view this in a modern browser such as Chrome or Microsoft Edge.");
            renderPage = false;
        }
    </script>

</head>

<body>
    <!-- Loader -->
    <div id="loader-wrapper">
        <div id="loader"></div>
        <div class="loader-section section-left"></div>
        <div class="loader-section section-right"></div>
    </div>
    <div class="container">
        <section class="tm-section-head" id="top">
            <header id="header" class="text-center tm-text-gray">
                <h1>Fast Robots: ECE 4960 Lab 2</h1>
            
            </header>

            <nav class="navbar narbar-light">
                <a class="navbar-brand tm-text-gray" href="#">
                    Menu
                </a>
                <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#mainNav" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon">
                        <i class="fa fa-navicon tm-fa-toggler-icon"></i>
                    </span>
                </button>
                <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link tm-text-gray" href="index.html">Home
                                <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link tm-text-gray" target="_blank" rel="noopener noreferrer" href="https://cei-lab.github.io/ECE4960/">Class Info</a>
                        </li>
						<li class="nav-item">
                            <a class="nav-link tm-text-gray" target="_blank" rel="noopener noreferrer" href="lab1.html">Lab 1</a>
                        </li>
						<li class="nav-item">
                            <a class="nav-link tm-text-gray" target="_blank" rel="noopener noreferrer" href="lab2.html">Lab 2</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="navbar navbar-default navbar-fixed-top">
                <a href="/index.html" class="navbar-brand"></a>
                <botton class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mydropdown">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </botton>

            </div>

            <div class="collapse navbar-collapse" id="mydropdown">

                <ul class="nav navbar-nav">
                    <li>
                        <a href="#">Home</a>
                    </li>
                    <li>
                        <a href="#">Class info</a>
                    </li>
					<li>
                        <a href="#">Lab 1</a>
                    </li>
					<li>
                        <a href="#">Lab 2</a>
                    </li>
                </ul>
            </div>
        </section>
        </section> --><div class="tm-box-3">
   <p class="btmspace-50 justified" >In lab 2, we are going to learn wireless communication with Bluetooth of the Artemis board. We will discuss the framework, the latency, and the data rate of the BLE modules. 

The first task is to setup USB passthrough so the adaptor should work with the Ubuntu VM. The BLE has existed on my computer (Windows 10), so the only setting we have to do is go to the VM devices → USB → Intel Bluetooth to enable the bluetooth on the VM. It can be verified by using the command “hciconfig” or “lsusb”, which is shown in Figure 1.
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/USB.png" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 1. Bluetooth connection verification.</p>
	
Next, we need to install the bleak library on python3 by running the command “python3 -m pip install bleak”. The bleak library is a GATT client software, capable of connecting to BLE devices acting as GATT servers. Figure 2 shows the installation process of the bleak.	   
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/installbleak.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 2. The installation process of bleak.</p>	   
Then, we upload the provided Arduino sketch to the Artemis board. However, it popped out an error that shows “wsf_types.h file is not found” because the version of the Apollo library in Arduino is too new (1.2.0), so we need to download the old version 1.1.2 to compile to program. Once the program is uploaded successfully, the blue LED blinks rapidly which shows in Video 1 and the serial monitor also shows the message in Figure 3. 
			
          <div style="text-align:center;"><iframe width="720" height="360" src="https://www.youtube.com/embed/usX29EjJ1rw" frameborder="0" allowfullscreen></iframe></div>
			<p class="btmspace-5 text-center" >Video 1: LED Blink with upload verification.</p>
	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/serialmonitor.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 3. Serial monitor of Bluetooth message.</p>
	  
	   Later, we run the main.py on VM to discover the BLE on the Artemis board and it will show the message in Figure 4 when the robot is found. 
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/mainfuc.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 4. The message when the robot is found.</p> 
	   We can now write several programs to understand the robot command framework. The basic structure is 99 bytes which include the first byte as the command type and the second byte is the length of the message. The rest of the bytes are the data information. The first experiment is to ping the robot by running the code “await theRobot.ping()”, which shows in Figure 5.
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/pingcode.png" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 5. The robot ping code.</p>
	   When we run the program, we could see the result in Figure 6.
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/robotpingval.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 6. The result of the robot ping.</p>
		   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/pingdata.jpg" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 7. Histogram of the robot ping.</p>
	   It can see the major time of the robot ping is between 138~154 ms and the average latency is 154.7 ms for 64 packets. From the main.py program and the serial monitor (l_Rcvd), we can see that there are 99 bytes per ping transferred and the transfer rate will be 10240 bits/seconds. It is slower than the serial connection which is 115200 bits per second for the program. 

	Next, we modified the program to request a float number. The code shows in Figure 8. We comment “await theRobot.ping()” and uncomment “await theRobot.sendCommand(Commands.REQ_FLOAT)” in the main.py to get the result in Figure 9.
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/floatcode.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 8. The float code.</p>
		   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/floatingpt.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 9. The result of requesting a float value.</p>
	   We could see the value that displayed to the screen is slightly different from the float that we tried to send. It means that the data will a little distortion by using Bluetooth, so the float comparison will not be accurate.

Last, we have already known what the round-latency is, so we want to understand the wireless data transfer rate is by modified the Ardunio code that shows in Figure 10. We want to send two different bytes values in order to compare the speed rate. The small value is 14 bytes and the large value is 46 bytes. Therefore, the first data set has one 32 bit value and one 64 bit value. The other data set has one 32 bit value and five 64 bit value. Also, we changed the code in main.py in order to match the unpack buffer that shows in Figure 11. 
	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/DATARATECODE.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 10. Data rate code.</p>
		   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/bytepy.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 11. Modification in SimpleHandler in main.py.</p>
	   We could see the part of the result in Figure 12. Then, we plotted the histogram using excel to compare the rate difference of two different bytes.
	   	   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/testdatarate.PNG" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 12. The result of the testing rate.</p>
		   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/transdata1.jpg" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 13. Histogram of the 14 bytes transfer.</p>
		   	<div style="text-align:center;">
    <img class="img-rounded" src="lab2/transdata2.jpg" alt="Set up 1" style="width:50%"></div>
     <p class="btmspace-5 text-center" >Figure 14. Histogram of the 46 bytes transfer.</p>
The average time of 14 bytes is 11.338 ms and the average time of 46 bytes is 11.49ms. Therefore, we can determine that the larger bytes will require a longer time to transfer the data. Besides, the 14 bytes should have 164 packets to be sent, but the system only received 90 packets instead, which means 32.9% packets were dropped. On the other hand, the 46 bytes should have 339 packets but only 85 packets are received, so there are 75 packets were dropped.	   
</p>

	</div>
<!--
        <section class="tm-section-4 tm-section-mb" id="tm-section-4">
            <div class="row">

            </div>
        </section>

        <section class="tm-section-5" id="tm-section-5">
            <div class="row">
                <div class="col-lg-4 col-md-12 col-sm-12">
                    <div class="image fit">
                        <img src="img/tm-sc4-img-1.jpg" class="img-fluid">
                    </div>
                </div>

                <div class="col-lg-8 col-md-12 col-sm-12 pl-lg-0">
                    <div class="media tm-media">
                        <img src="img/sc4-img-2.jpg" class="img-responsive tm-media-img">
                        <div class="media-body tm-box-5">
                            <h2>Etiam tincidunt ullamcorper</h2>
                            <p class="mb-0">Maecenas tempor nibh sed rhoncus ullamcorper. Ut porttitor ante non accumsan pretium. Maecenas iaculis arcu sed porta accumsan.</p>
                        </div>
                    </div>
                    <div class="media tm-media">
                        <img src="img/sc4-img-3.jpg" class="img-responsive tm-media-img">
                        <div class="media-body tm-box-5">
                            <h2>Sed et finibus tortor</h2>
                            <p class="mb-0">Suspendisse iaculis leo libero, ut congue augue feugiat eu. Nulla faucibus non odio sed auctor. Vestibulum a tincidunt dolor, eget eleifend lacus.</p>
                        </div>
                    </div>
                    <div class="media tm-media">
                        <img src="img/sc4-img-4.jpg" class="img-responsive tm-media-img">
                        <div class="media-body tm-box-5">
                            <h2>Vestibulum sit amet</h2>
                            <p class="mb-0"> Cras aliquet urna ut sapien tincidunt, quis malesuada elit facilisis. Vestibulum sit amet tortor velit. Nam elementum nibh a libero pharetra elementum. </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="tm-section-6" id="tm-section-6">
            <div class="row">
                <div class="col-lg-7 col-md-7 col-xs-12">
                    <div class="contact_message">
                        <form action="" method="post" class="contact-form">
                            <div class="row mb-2">
                                <div class="form-group col-xl-6">
                                    <input type="text" id="contact_name" name="contact_name" class="form-control" placeholder="Name" required/>
                                </div>
                                <div class="form-group col-xl-6 pl-xl-1">
                                    <input type="email" id="contact_email" name="contact_email" class="form-control" placeholder="Email" required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <textarea id="contact_message" name="contact_message" class="form-control" rows="6" placeholder="Message" required></textarea>
                            </div>
                            <button type="submit" class="btn  tm-btn-submit float-right btn-big">Send It Now</button>
                        </form>
                    </div>
                </div>

                <div class="col-lg-5 col-md-5 col-xs-12 tm-contact-right">
                    <div class="tm-address-box">
                        <h2 class="mb-4">Contact Us</h2>
                        <p class="mb-5">Integer pretium volutpat tempor. Maecenas condimentum tincidunt leo. Paesent scelerisque erat placerat tempus laoreet. Vivamus pellentesque tempor congue.</p>
                        <address>
                            120-240 Proin mauris enim,
                            <br> dignissim sit amet ligula id,
                            <br> finibus tempus erat 10200
                        </address>
                    </div>
                </div> 
            </div>
        </section> -->
        <footer class="mt-5">
            <p class="text-center">Copyright © 2020 Junghsien Wei (Sam) - ECE 4960</p>
        </footer>
    </div>

    <!-- load JS files -->
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script src="js/popper.min.js"></script>
    <!-- https://popper.js.org/ -->
    <script src="js/bootstrap.min.js"></script>
    <!-- https://getbootstrap.com/ -->
    <script type="text/javascript" src="slick/slick.min.js"></script>
    <!-- Slick Carousel -->

    <script>
        function setCarousel() {
            var slider = $('.tm-img-slider');

            if (slider.hasClass('slick-initialized')) {
                slider.slick('destroy');
            }

            if ($(window).width() > 991) {
                // Slick carousel
                slider.slick({
                    autoplay: true,
                    fade: true,
                    speed: 800,
                    infinite: true,
                    slidesToShow: 1,
                    slidesToScroll: 1
                });
            } else {
                slider.slick({
                    autoplay: true,
                    fade: true,
                    speed: 800,
                    infinite: true,
                    slidesToShow: 1,
                    slidesToScroll: 1
                });
            }
        }

        $(document).ready(function () {
            if (renderPage) {
                $('body').addClass('loaded');
            }

            setCarousel();

            $(window).resize(function () {
                setCarousel();
            });

            // Close menu after link click
            $('.nav-link').click(function () {
                $('#mainNav').removeClass('show');
            });

            // https://css-tricks.com/snippets/jquery/smooth-scrolling/
            // Select all links with hashes
            $('a[href*="#"]')
                // Remove links that don't actually link to anything
                .not('[href="#"]')
                .not('[href="#0"]')
                .click(function (event) {
                    // On-page links
                    if (
                        location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '')
                        &&
                        location.hostname == this.hostname
                    ) {
                        // Figure out element to scroll to
                        var target = $(this.hash);
                        target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                        // Does a scroll target exist?
                        if (target.length) {
                            // Only prevent default if animation is actually gonna happen
                            event.preventDefault();
                            $('html, body').animate({
                                scrollTop: target.offset().top + 1
                            }, 1000, function () {
                                // Callback after animation
                                // Must change focus!
                                var $target = $(target);
                                $target.focus();
                                if ($target.is(":focus")) { // Checking if the target was focused
                                    return false;
                                } else {
                                    $target.attr('tabindex', '-1'); // Adding tabindex for elements not focusable
                                    $target.focus(); // Set focus again
                                };
                            });
                        }
                    }
                });
        });
    </script>

</body>

</html>